<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../paper-styles/color.html">
<link rel="import" href="../paper-styles/typography.html">
<link rel="import" href="../paper-styles/default-theme.html">
<link rel="import" href="mammooc-cumulative-rating.html">
<link rel="import" href="mammooc-course-evaluation.html">
<link rel="import" href="mammooc-course-evaluation-form.html">

<!--
An element providing a rating widget for mammooc.

Example:

    <mammooc-rating-widget provider="openHPI" course-id="2">
    </mammooc-rating-widget>

### Styling

`<mammooc-rating-widget>` provides the following custom properties and mixins
for styling:

Custom property | Description | Default
----------------|-------------|----------
`--rating-filled-color` | Fill color of the selected rating shapes | #ffac33
`--rating-unfilled-color` | Fill color of remaining rating shapes | #ccd6dd
`--mammooc-rating-widget-background-color` | Background color of the entire widget | #eee



@demo demo/index.html
-->
<dom-module id="mammooc-rating-widget">
    <template>
        <style>
          paper-card {
              --paper-card-header: {
                  background: var(--rating-filled-color);
              };
              --paper-card-header-text: {
                  color: white;
              };
              width: inherit;
              height: auto;
        };


        </style>
        <iron-ajax auto url="{{_generateUrl(provider, courseId)}}"
            on-response="_handleResponse">
        </iron-ajax>
        <paper-card heading="Course evaluation">
          <div class="card-content">
              <mammooc-cumulative-rating cumulative-rating="{{_cumulativeRating}}" rating-count="{{_ratingCount}}"></mammooc-cumulative-rating>
          </div>
          <div class="card-content">
              <mammooc-course-evaluation evaluations="{{_evaluations}}"></mammooc-course-evaluation>
          </div>
          <div class="card-actions">
              <mammooc-course-evaluation-form></mammooc-course-evaluation-form>
          </div>
        </paper-card>
    </template>

    <script>
    Polymer({
        is: 'mammooc-rating-widget',
        properties: {
            /**
            *    The provider of the course, e.g. "openHPI"
            */
            provider: String,

            /**
            *   The ID of the course in the provider's system
            */
            courseId: String,

            _cumulativeRating: Number,
            _ratingCount: Number,
            _evaluations: Object,

        },
        _generateUrl: function(provider, courseId) {
            return "https://mammooc-dev.herokuapp.com/evaluations/export?provider=" + this.provider + "&course_id=" + this.courseId;
        },

        _handleResponse: function(request) {
            var evaluation = request.detail.response.evaluations[0];
            this._cumulativeRating = evaluation.overall_rating;
            this._ratingCount = evaluation.number_of_evaluations;
            this._evaluations = evaluation.user_evaluations;
        },
        listeners: {

        },
    });
    </script>
<dom-module>
